---
title: "Assignment 2"
author: "Huy"
date: "2023-10-31"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(readxl)
library(caret)
library(e1071)
library(glmnet)
library(ISLR)
```

# Phase 1

Load the dataset containing monthly values of VIX and all categories of monthly EMV trackers from January 1990 - December 2022, and develop a regression model not only to for the purpose of predicting the future values of VIX. But, more importantly, the results of the regression analysis should possibly lead to new information by revealing the economic, financial and political factors that affect the behaviour of VIX over time.

For implementation purposes, you are free to either use your previous program codes, the glmnet library, or any other packages available on open source. Also, note that the last column corresponds to values of VIX at month t+1, whereas its covariates at each row pertain to month t.

Solve this problem using OLS, LASSO, Ridge Regression and Elastic Net Regression, and compare their performances by providing a thorough interpretation of their results. For each method, you may discuss its advantages and drawbacks, such as presence of multicollinearity, and then elaborate on their other aspects like feature selection, sparsity, etc.

Can you provide a coherent picture of mechanisms underlying the sudden volatility changes in stock markets in the past 23 years?

```{r}
# load the data
df <- read_excel("/Users/hwey/Downloads/EMV_VIX_Data.xlsx")

# exclude all observations with missing data
df = na.omit(df)

# return the dimensions of the data frame
dim(df)

# define the response variable 
y <- df$VIX

# define matrix of predictor variables
x <- model.matrix(VIX~., data = df)

# x <- data.matrix(data[, c('Political Uncertainty Tracker',
#               'Infectious Disease EMV Tracker',
#               'Macroeconomic News and Outlook EMV Tracker',
#               'Macro – Broad Quantity Indicators EMV Tracker',
#               'Macro – Inflation EMV Indicator',
#               'Macro – Interest Rates EMV Tracker',
#               'Macro – Other Financial Indicators EMV Tracker',
#               'Macro – Labor Markets EMV Tracker',
#               'Macro – Real Estate Markets EMV Tracker',
#               'Macro – Trade EMV Tracker',
#               'Macro – Business Investment and Sentiment EMV Tracker',
#               'Macro – Consumer Spending and Sentiment EMV Tracker', 
#               'Commodity Markets EMV Tracker',
#               'Financial Crises EMV Tracker',
#               'Exchange Rates EMV Tracker',
#               'Healthcare Matters EMV Tracker',
#               'Litigation Matters EMV Tracker',
#               'Competition Matters EMV Tracker',
#               'Labor Disputes EMV Tracker',
#               'Intellectual Property Matters EMV Tracker',
#               'Fiscal Policy EMV Tracker',
#               'Taxes EMV Tracker',
#               'Government Spending, Deficits, and Debt EMV Tracker',
#               'Entitlement and Welfare Programs EMV Tracker',
#               'Monetary Policy EMV Tracker',
#               'Regulation EMV Tracker',
#               'Financial Regulation EMV Tracker',
#               'Competition Policy EMV Tracker',
#               'Intellectual Property Policy EMV Tracker',
#               'Labor Regulations EMV Tracker',
#               'Immigration EMV Tracker',
#               'Energy and Environmental Regulation EMV Tracker',
#               'Lawsuit and Tort Reform, Supreme Court Decisions EMV Tracker',
#               'Housing and Land Management EMV Tracker',
#               'Other Regulation EMV Tracker',
#               'National Security Policy EMV Tracker',
#               'Government-Sponsored Enterprises EMV Tracker',
#               'Trade Policy EMV Tracker',
#               'Healthcare Policy EMV Tracker',
#               'Food and Drug Policy EMV Tracker',
#               'Transportation, Infrastructure, and Public Utilities EMV Tracker',
#               'Elections and Political Governance EMV Tracker',
#               'Agricultural Policy EMV Tracker',
#               'Petroleum Markets EMV Tracker')]) 

```

## OLS Regression

Ordinary least square (OLS) regression is a method that allows us to find a line that best describes the relationship between one or more predictor variables and a response variable.

```{r}
library(tidyverse)
library(ggplot2)
library(readxl)
```

### Visualize the data

```{r pressure, echo=FALSE}
plot(data$EMV, data$VIX)
```

### Build OLS Regression Model

```{r pressure, echo=FALSE}
# fit multiple linear regression model
model <- lm(data$VIX~data$`Political Uncertainty Tracker`+
              data$`Infectious Disease EMV Tracker` + 
              data$`Macroeconomic News and Outlook EMV Tracker` +
              data$`Macro – Broad Quantity Indicators EMV Tracker` +
              data$`Macro – Inflation EMV Indicator` +
              data$`Macro – Interest Rates EMV Tracker` +
              data$`Macro – Other Financial Indicators EMV Tracker` +
              data$`Macro – Labor Markets EMV Tracker` +
              data$`Macro – Real Estate Markets EMV Tracker` +
              data$`Macro – Trade EMV Tracker` +
              data$`Macro – Business Investment and Sentiment EMV Tracker` +
              data$`Macro – Consumer Spending and Sentiment EMV Tracker` + 
              data$`Commodity Markets EMV Tracker` +
              data$`Financial Crises EMV Tracker` +
              data$`Exchange Rates EMV Tracker` +
              data$`Healthcare Matters EMV Tracker` +
              data$`Litigation Matters EMV Tracker` +
              data$`Competition Matters EMV Tracker` +
              data$`Labor Disputes EMV Tracker` +
              data$`Intellectual Property Matters EMV Tracker` +
              data$`Fiscal Policy EMV Tracker` +
              data$`Taxes EMV Tracker` +
              data$`Government Spending, Deficits, and Debt EMV Tracker` +
              data$`Entitlement and Welfare Programs EMV Tracker` +
              data$`Monetary Policy EMV Tracker` +
              data$`Regulation EMV Tracker` +
              data$`Financial Regulation EMV Tracker` +
              data$`Competition Policy EMV Tracker` + 
              data$`Intellectual Property Policy EMV Tracker` +
              data$`Labor Regulations EMV Tracker` +
              data$`Immigration EMV Tracker` +
              data$`Energy and Environmental Regulation EMV Tracker` +
              data$`Lawsuit and Tort Reform, Supreme Court Decisions EMV Tracker` +
              data$`Housing and Land Management EMV Tracker` +
              data$`Other Regulation EMV Tracker` +
              data$`National Security Policy EMV Tracker` +
              data$`Government-Sponsored Enterprises EMV Tracker` +
              data$`Trade Policy EMV Tracker` +
              data$`Healthcare Policy EMV Tracker` +
              data$`Food and Drug Policy EMV Tracker` +
              data$`Transportation, Infrastructure, and Public Utilities EMV Tracker` +
              data$`Elections and Political Governance EMV Tracker` +
              data$`Agricultural Policy EMV Tracker` +
              data$`Petroleum Markets EMV Tracker`, data = data)
```

### Create Residual Plots

```{r pressure, echo=FALSE}
residual <- resid(model)
```

```{r pressure, echo=FALSE}
plot(fitted(model), residual)
abline(0,0)
```

### Validate Model Reliability

The residuals of the Multiple Linear Regression appear to be concentrating around 0 between the values of 10 and 30 of the model. The residuals, when plotted against the model, exhibits a particular pattern.

Therefore, we failed to assume homogeneity of variances for the model.

Hence, OLS Regression Model are not applicable.

## LASSO Regression

Previously, we failed to fit the data into a OLS Regression Model, therefore, mutlicollinearity and other factors are existent.

Lasso regression is a method we can use to fit a regression model when multicollinearity is present in the data.

In this case, we will fix the value of $\alpha$ to 1 to fit the data in Lasso Regression Model.

```{r}
library(glmnet)
library(tidyverse)
library(ggplot2)
library(e1071)
library(caret)
```

### Perform k-fold CV to learn optimal degree

```{r pressure, echo=FALSE}
# fit cross-validation model with alpha = 1 
lasso.cv <- cv.glmnet(x, y, type.measure="mse", alpha=1, family="gaussian", nlambda=200, nfolds=10)

# find the optimal lambda value
lasso.cv$lambda.min
```

### Visualize Lasso Regression Model and Lambda values

```{r pressure, echo=FALSE}
plot(lasso.cv)
abline(h = lasso.cv$cvup[lasso.cv$index[1]], lty = 4)
```

Comment on the plot of lasso.cv

```{r pressure, echo=FALSE}
# find the maximum value of lambda
lasso.cv$lambda.1se
lasso = glmnet(x, y, alpha = 1)
plot(lasso, xvar = 'lambda')
abline(v = log(lasso.cv$lambda.min), lty = 3)
abline(v = log(lasso.cv$lambda.1se), lty = 3)
```

## Ridge Regression

In this case, we will fix the value of $\alpha$ to 0 fit the data in Ridge Regression Model and find the optimal $\lambda$ value.

```{r}
library(tidyverse)
library(ggplot2)
library(glmnet)
library(ISLR)
```

### Fit the data into Ridge Regression Model

```{r pressure, echo=FALSE}

```

## Elastic Net Regression

Use trainControl() and train() functions to fit the Elastic Net Regression model to the data. 

The goal is to find the optimal $\alpha$ and $\lambda$

```{r}
k <- 10
set.seed(1)
train_control <- trainControl(method = "cv", number = k)

elastic_model <- train(y ~ ., data = cbind(x,y), method = "glmnet", preProcess = c("center", "scale"), tuneLength = 10, trControl = train_control)

print(elastic_model)
```
### Load and visualize the data

# Phase 2

Most often, the forces driving the market movements themselves undergo changes when a transition occurs from one segment of time into its following one(s). Use elastic nets to construct predictive regression models for each segment of stock market and then interpret the results with the goal of extracting knowledge about the phenomena causing the regime switches and apparent transitions.

Can you characterize the nature of the most dominant forces responsible for driving the stock market movements within each segment? Are there any pattern on sparsity of forces when comparing chaotic (pink) and normal (blue) segments of the stock market?

Can you provide a coherent picture of mechanisms underlying the sudden volatility changes in stock markets in the past 23 years, by further considering the relatively homogeneous segments of the market?

```{r pressure, echo=FALSE}

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
